<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Join Team</title>
  <script src="/socket.io/socket.io.js"></script>
  <!--<script src="/client.js"></script>-->
</head>
<body>
  <h1>Welcome to the Escape Room!</h1>
  
  <form id="teamForm">
    <input type="text" id="teamIdInput" placeholder="Enter team ID" required />
    <button type="submit">Join Team</button>
  </form>
</body>

<script>
// Use the existing global socket instance
socket = window.socket;

// Handle the form submit where player chooses a team
document.getElementById('teamForm').addEventListener('submit', (e) => {
  e.preventDefault();

  // Get the team ID from the input field
  const teamId = document.getElementById('teamIdInput').value.trim();

  if (!teamId) {
    alert('Please enter a team ID!');
    return;
  }

  // Send team ID to the server
  socket.emit('joinTeam', { teamId });
});

// Listen for server responses:

// If the team is full
socket.on('teamFull', () => {
  alert('Sorry, this team is already full. Please choose another team.');
});

// Update when team members change
socket.on('teamUpdate', (data) => {
  console.log('Team updated:', data);
  // You could update a UI list of connected players here
});

const clientContentMap = {}; // Store content for each client
// When team is ready to start

socket.on('teamReady', (numberOfPlayers) => {
  console.log('Number of players:', numberOfPlayers);
  // Redirect to game page automatically, or show a start button
  for (let i = 0; i < numberOfPlayers; i++) {
    let contentPath = 'levels/level1.html'; // Default content path
    if (i === 1) {
      contentPath = 'levels/level2.html';
    }
    console.log('Content file to serve:', contentPath);
    fs.readFile(contentPath, 'utf8', (err, fileData) => {
      if (err) {
        console.error('Error reading file:', err);
        return;
      }
      clientContentMap[socket.id] = fileData;
      console.log(`File read successfully`);
      socket.emit('updateContent', clientContentMap[socket.id]);
      socket.emit('updateLevel', 5); // Example: change level to 1
    });
  }
});

// Handle general errors
socket.on('errorJoiningTeam', (error) => {
  alert('Error: ' + error.message);
});

</script>

</html>

